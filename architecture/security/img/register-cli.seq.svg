<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1234px" preserveAspectRatio="none" style="width:700px;height:1234px;background:#FFFFFF;" version="1.1" viewBox="0 0 700 1234" width="700px" zoomAndPan="magnify"><defs><filter height="300%" id="fkk8pdgabe474" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fkk8pdgabe474)" height="1146.9336" style="stroke:#A80036;stroke-width:1.0;" width="10" x="230.5" y="71.7988"/><rect fill="#FFFFFF" filter="url(#fkk8pdgabe474)" height="198.1738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="459.5" y="371.2148"/><rect fill="#FFFFFF" filter="url(#fkk8pdgabe474)" height="188.9961" style="stroke:#A80036;stroke-width:1.0;" width="10" x="459.5" y="676.3203"/><rect fill="#FFFFFF" filter="url(#fkk8pdgabe474)" height="214.6738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="459.5" y="926.4375"/><rect fill="#FFFFFF" filter="url(#fkk8pdgabe474)" height="786.5176" style="stroke:#000000;stroke-width:2.0;" width="676.5" x="10" y="86.7988"/><rect fill="#FFFFFF" filter="url(#fkk8pdgabe474)" height="170.1738" style="stroke:#000000;stroke-width:2.0;" width="360" x="20" y="111.1094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="54" x2="54" y1="40.4883" y2="1227.7324"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="235" x2="235" y1="40.4883" y2="1227.7324"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="464" x2="464" y1="40.4883" y2="1227.7324"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="652.5" x2="652.5" y1="40.4883" y2="1227.7324"/><rect fill="#FEFECE" filter="url(#fkk8pdgabe474)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="45" x="30" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="37" y="25.5352">User</text><rect fill="#FEFECE" filter="url(#fkk8pdgabe474)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="35" x="216" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="223" y="25.5352">CLI</text><rect fill="#FEFECE" filter="url(#fkk8pdgabe474)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="71" x="427" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="434" y="25.5352">Gateway</text><rect fill="#FEFECE" filter="url(#fkk8pdgabe474)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="44" x="628.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="635.5" y="25.5352">Ably</text><rect fill="#FFFFFF" filter="url(#fkk8pdgabe474)" height="1146.9336" style="stroke:#A80036;stroke-width:1.0;" width="10" x="230.5" y="71.7988"/><rect fill="#FFFFFF" filter="url(#fkk8pdgabe474)" height="198.1738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="459.5" y="371.2148"/><rect fill="#FFFFFF" filter="url(#fkk8pdgabe474)" height="188.9961" style="stroke:#A80036;stroke-width:1.0;" width="10" x="459.5" y="676.3203"/><rect fill="#FFFFFF" filter="url(#fkk8pdgabe474)" height="214.6738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="459.5" y="926.4375"/><polygon fill="#A80036" points="218.5,67.7988,228.5,71.7988,218.5,75.7988,222.5,71.7988" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="54.5" x2="224.5" y1="71.7988" y2="71.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="61.5" y="67.0566">open account/timesheet</text><path d="M10,86.7988 L72,86.7988 L72,93.7988 L62,103.7988 L10,103.7988 L10,86.7988 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="786.5176" style="stroke:#000000;stroke-width:2.0;" width="676.5" x="10" y="86.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="25" y="100.3672">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="19" x="87" y="99.4336">[No</text><text fill="#000000" font-family="monospace" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="56" x="110" y="99.1597">ably.key</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="61" x="170" y="99.4336">or expired]</text><path d="M20,111.1094 L82,111.1094 L82,118.1094 L72,128.1094 L20,128.1094 L20,111.1094 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="170.1738" style="stroke:#000000;stroke-width:2.0;" width="360" x="20" y="111.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="35" y="124.6777">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="165" x="97" y="123.7441">[No principal.@id configured]</text><path d="M100,133.4199 L100,210.4199 L366,210.4199 L366,143.4199 L356,133.4199 L100,133.4199 " fill="#FBFB77" filter="url(#fkk8pdgabe474)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M356,133.4199 L356,143.4199 L366,143.4199 L356,133.4199 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="106" y="150.9883">configured principal.@id is the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="106" y="166.2988">user account, account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="245" y="169.9316">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="251" y="166.2988">.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="106" y="184.6094">Not always the same as requested</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="106" y="199.9199">timesheet account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="4" x="222" y="203.5527">t</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="226" y="199.9199">, but use as default.</text><polygon fill="#A80036" points="65.5,236.9727,55.5,240.9727,65.5,244.9727,61.5,240.9727" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="59.5" x2="229.5" y1="240.9727" y2="240.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="71.5" y="236.2305">"your account?"</text><polygon fill="#A80036" points="218.5,269.2832,228.5,273.2832,218.5,277.2832,222.5,273.2832" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="54.5" x2="224.5" y1="273.2832" y2="273.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="61.5" y="265.541">account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="111.5" y="269.1738">u</text><polygon fill="#A80036" points="65.5,305.5938,55.5,309.5938,65.5,313.5938,61.5,309.5938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="59.5" x2="229.5" y1="309.5938" y2="309.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="71.5" y="304.8516">"pls enter email"</text><polygon fill="#A80036" points="218.5,334.9043,228.5,338.9043,218.5,342.9043,222.5,338.9043" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="54.5" x2="224.5" y1="338.9043" y2="338.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="61.5" y="334.1621">email</text><polygon fill="#A80036" points="447.5,367.2148,457.5,371.2148,447.5,375.2148,451.5,371.2148" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="240.5" x2="453.5" y1="371.2148" y2="371.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="247.5" y="363.4727">jwe(account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="322.5" y="367.1055">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="328.5" y="363.4727">, email)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="469.5" x2="511.5" y1="421.8359" y2="421.8359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="511.5" x2="511.5" y1="421.8359" y2="434.8359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="470.5" x2="511.5" y1="434.8359" y2="434.8359"/><polygon fill="#A80036" points="480.5,430.8359,470.5,434.8359,480.5,438.8359,476.5,434.8359" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="476.5" y="395.7832">If account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="539.5" y="399.416">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="549.5" y="395.7832">exists, check</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="476.5" y="414.0938">account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="526.5" y="417.7266">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="536.5" y="414.0938">and email match</text><polygon fill="#A80036" points="251.5,484.957,241.5,488.957,251.5,492.957,247.5,488.957" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="245.5" x2="458.5" y1="488.957" y2="488.957"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="19" x="257.5" y="481.2148">jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="276.5" y="484.8477">a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="286.5" y="481.2148">encrypted with code</text><path d="M29,447.8359 L29,508.8359 L221,508.8359 L221,457.8359 L211,447.8359 L29,447.8359 " fill="#FBFB77" filter="url(#fkk8pdgabe474)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M211,447.8359 L211,457.8359 L221,457.8359 L211,447.8359 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="19" x="35" y="465.4043">jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="54" y="469.0371">a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="64" y="465.4043">(activation jwt)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="35" y="483.7148">has ⦉ account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="120" y="487.3477">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="126" y="483.7148">, email ⦊</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="35" y="502.0254">signed with Gateway secret</text><polygon fill="#A80036" points="65.5,536.0781,55.5,540.0781,65.5,544.0781,61.5,540.0781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="59.5" x2="229.5" y1="540.0781" y2="540.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="71.5" y="535.3359">"pls enter emailed code"</text><polygon fill="#A80036" points="65.5,565.3887,55.5,569.3887,65.5,573.3887,61.5,569.3887" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="59.5" x2="463.5" y1="569.3887" y2="569.3887"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="71.5" y="564.6465">activation code by email</text><polygon fill="#A80036" points="218.5,594.6992,228.5,598.6992,218.5,602.6992,222.5,598.6992" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="54.5" x2="224.5" y1="598.6992" y2="598.6992"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="61.5" y="593.957">code</text><line style="stroke:#A80036;stroke-width:1.0;" x1="240.5" x2="282.5" y1="631.0098" y2="631.0098"/><line style="stroke:#A80036;stroke-width:1.0;" x1="282.5" x2="282.5" y1="631.0098" y2="644.0098"/><line style="stroke:#A80036;stroke-width:1.0;" x1="241.5" x2="282.5" y1="644.0098" y2="644.0098"/><polygon fill="#A80036" points="251.5,640.0098,241.5,644.0098,251.5,648.0098,247.5,644.0098" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="247.5" y="623.2676">decrypt jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="317.5" y="626.9004">a</text><polygon fill="#A80036" points="447.5,672.3203,457.5,676.3203,447.5,680.3203,451.5,676.3203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="240.5" x2="453.5" y1="676.3203" y2="676.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45" x="247.5" y="668.5781">key(jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="292.5" y="672.2109">a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="298.5" y="668.5781">)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="469.5" x2="511.5" y1="720.9414" y2="720.9414"/><line style="stroke:#A80036;stroke-width:1.0;" x1="511.5" x2="511.5" y1="720.9414" y2="733.9414"/><line style="stroke:#A80036;stroke-width:1.0;" x1="470.5" x2="511.5" y1="733.9414" y2="733.9414"/><polygon fill="#A80036" points="480.5,729.9414,470.5,733.9414,480.5,737.9414,476.5,733.9414" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="476.5" y="700.8887">create Account</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="476.5" y="716.1992">if required</text><polygon fill="#A80036" points="480.5,774.5625,470.5,778.5625,480.5,782.5625,476.5,778.5625" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="640.5,774.5625,650.5,778.5625,640.5,782.5625,644.5,778.5625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="474.5" x2="646.5" y1="778.5625" y2="778.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="486.5" y="758.5098">create/update key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="486.5" y="773.8203">&amp; capabilities</text><line style="stroke:#A80036;stroke-width:1.0;" x1="469.5" x2="511.5" y1="823.1836" y2="823.1836"/><line style="stroke:#A80036;stroke-width:1.0;" x1="511.5" x2="511.5" y1="823.1836" y2="836.1836"/><line style="stroke:#A80036;stroke-width:1.0;" x1="470.5" x2="511.5" y1="836.1836" y2="836.1836"/><polygon fill="#A80036" points="480.5,832.1836,470.5,836.1836,480.5,840.1836,476.5,836.1836" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="476.5" y="803.1309">store keyid</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="476.5" y="818.4414">in Account</text><polygon fill="#A80036" points="251.5,861.3164,241.5,865.3164,251.5,869.3164,247.5,865.3164" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="245.5" x2="463.5" y1="865.3164" y2="865.3164"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="257.5" y="860.2505">ably.key</text><polygon fill="#A80036" points="447.5,922.4375,457.5,926.4375,447.5,930.4375,451.5,926.4375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="240.5" x2="453.5" y1="926.4375" y2="926.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="247.5" y="918.6953">config(account/timesheet, jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="437.5" y="922.3281">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="443.5" y="918.6953">)</text><path d="M59,885.3164 L59,946.3164 L221,946.3164 L221,895.3164 L211,885.3164 L59,885.3164 " fill="#FBFB77" filter="url(#fkk8pdgabe474)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M211,885.3164 L211,895.3164 L221,895.3164 L211,885.3164 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="19" x="65" y="902.8848">jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="84" y="906.5176">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="94" y="902.8848">(user jwt)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="65" y="921.1953">is ⦉ account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="139" y="924.8281">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="145" y="921.1953">, keyid ⦊</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73" x="65" y="939.5059">signed with</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="142" y="939.1821">ably.key</text><line style="stroke:#A80036;stroke-width:1.0;" x1="469.5" x2="511.5" y1="995.8691" y2="995.8691"/><line style="stroke:#A80036;stroke-width:1.0;" x1="511.5" x2="511.5" y1="995.8691" y2="1008.8691"/><line style="stroke:#A80036;stroke-width:1.0;" x1="470.5" x2="511.5" y1="1008.8691" y2="1008.8691"/><polygon fill="#A80036" points="480.5,1004.8691,470.5,1008.8691,480.5,1012.8691,476.5,1008.8691" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="476.5" y="972.8164">check account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="567.5" y="976.4492">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="476.5" y="991.127">corresponds to keyid</text><line style="stroke:#A80036;stroke-width:1.0;" x1="469.5" x2="511.5" y1="1056.4902" y2="1056.4902"/><line style="stroke:#A80036;stroke-width:1.0;" x1="511.5" x2="511.5" y1="1056.4902" y2="1069.4902"/><line style="stroke:#A80036;stroke-width:1.0;" x1="470.5" x2="511.5" y1="1069.4902" y2="1069.4902"/><polygon fill="#A80036" points="480.5,1065.4902,470.5,1069.4902,480.5,1073.4902,476.5,1069.4902" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="476.5" y="1033.4375">check account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="567.5" y="1037.0703">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="577.5" y="1033.4375">has</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="476.5" y="1051.748">access to timesheet</text><line style="stroke:#A80036;stroke-width:1.0;" x1="469.5" x2="511.5" y1="1098.8008" y2="1098.8008"/><line style="stroke:#A80036;stroke-width:1.0;" x1="511.5" x2="511.5" y1="1098.8008" y2="1111.8008"/><line style="stroke:#A80036;stroke-width:1.0;" x1="470.5" x2="511.5" y1="1111.8008" y2="1111.8008"/><polygon fill="#A80036" points="480.5,1107.8008,470.5,1111.8008,480.5,1115.8008,476.5,1111.8008" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="476.5" y="1094.0586">update key capability</text><polygon fill="#A80036" points="251.5,1137.1113,241.5,1141.1113,251.5,1145.1113,247.5,1141.1113" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="245.5" x2="463.5" y1="1141.1113" y2="1141.1113"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="257.5" y="1136.3691">config</text><polygon fill="#A80036" points="640.5,1166.4219,650.5,1170.4219,640.5,1174.4219,644.5,1170.4219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="240.5" x2="646.5" y1="1170.4219" y2="1170.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251" x="247.5" y="1165.6797">connect to timesheet channels via m-ld</text><path d="M35,1183.4219 L35,1208.4219 L255,1208.4219 L255,1193.4219 L245,1183.4219 L35,1183.4219 " fill="#FBFB77" filter="url(#fkk8pdgabe474)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M245,1183.4219 L245,1193.4219 L255,1193.4219 L245,1183.4219 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="72.5" y="1200.9902">Proceed with session</text><!--MD5=[c6d19130bc577a9dedde96c23097cc57]
@startuml
'https://plantuml.com/sequence-diagram
hide footbox

User -> CLI ++: open account/timesheet
alt No ""ably.key"" or expired
  alt No principal.@id configured
    note over CLI
      configured principal.@id is the
      user account, account<sub>u</sub>.
      Not always the same as requested
      timesheet account<sub>t</sub>, but use as default.
    end note
    CLI -> User: "your account?"
    User - -> CLI: account<sub>u</sub>
  end
  CLI -> User: "pls enter email"
  User - -> CLI: email
  CLI -> Gateway ++: jwe(account<sub>u</sub>, email)
  Gateway -> Gateway: If account<sub>u</sub> exists, check\naccount<sub>u</sub> and email match
  Gateway - -> CLI: jwt<sub>a</sub> encrypted with code
  note left
    jwt<sub>a</sub> (activation jwt)
    has ⦉ account<sub>u</sub>, email ⦊
    signed with Gateway secret
  end note
  CLI -> User: "pls enter emailed code"
  Gateway - -> User - -: activation code by email

  User - -> CLI: code
  ' TODO: brute force attack (look for a parseable JWT)
  CLI -> CLI: decrypt jwt<sub>a</sub>
  ' TODO: replay attack within JWT validity period
  CLI -> Gateway ++: key(jwt<sub>a</sub>)
  Gateway -> Gateway: create Account\nif required
  Gateway <-> Ably: create/update key\n& capabilities
  Gateway -> Gateway: store keyid\nin Account
  return ""ably.key""
end

CLI -> Gateway ++: config(account/timesheet, jwt<sub>u</sub>)
note left
  jwt<sub>u</sub> (user jwt)
  is ⦉ account<sub>u</sub>, keyid ⦊
  signed with ""ably.key""
end note
Gateway -> Gateway: check account<sub>u</sub>\ncorresponds to keyid
Gateway -> Gateway: check account<sub>u</sub> has\naccess to timesheet
Gateway -> Gateway: update key capability
return config

CLI -> Ably: connect to timesheet channels via m-ld
note over User, CLI: Proceed with session

@enduml

@startuml
hide footbox

User -> CLI ++: open account/timesheet
alt No ""ably.key"" or expired
  alt No principal.@id configured
    note over CLI
      configured principal.@id is the
      user account, account<sub>u</sub>.
      Not always the same as requested
      timesheet account<sub>t</sub>, but use as default.
    end note
    CLI -> User: "your account?"
    User - -> CLI: account<sub>u</sub>
  end
  CLI -> User: "pls enter email"
  User - -> CLI: email
  CLI -> Gateway ++: jwe(account<sub>u</sub>, email)
  Gateway -> Gateway: If account<sub>u</sub> exists, check\naccount<sub>u</sub> and email match
  Gateway - -> CLI: jwt<sub>a</sub> encrypted with code
  note left
    jwt<sub>a</sub> (activation jwt)
    has ⦉ account<sub>u</sub>, email ⦊
    signed with Gateway secret
  end note
  CLI -> User: "pls enter emailed code"
  Gateway - -> User - -: activation code by email

  User - -> CLI: code
  CLI -> CLI: decrypt jwt<sub>a</sub>
  CLI -> Gateway ++: key(jwt<sub>a</sub>)
  Gateway -> Gateway: create Account\nif required
  Gateway <-> Ably: create/update key\n& capabilities
  Gateway -> Gateway: store keyid\nin Account
  return ""ably.key""
end

CLI -> Gateway ++: config(account/timesheet, jwt<sub>u</sub>)
note left
  jwt<sub>u</sub> (user jwt)
  is ⦉ account<sub>u</sub>, keyid ⦊
  signed with ""ably.key""
end note
Gateway -> Gateway: check account<sub>u</sub>\ncorresponds to keyid
Gateway -> Gateway: check account<sub>u</sub> has\naccess to timesheet
Gateway -> Gateway: update key capability
return config

CLI -> Ably: connect to timesheet channels via m-ld
note over User, CLI: Proceed with session

@enduml

PlantUML version 1.2021.10(Mon Aug 30 14:43:48 BST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>