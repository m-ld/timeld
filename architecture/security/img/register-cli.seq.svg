<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1152px" preserveAspectRatio="none" style="width:744px;height:1152px;background:#FFFFFF;" version="1.1" viewBox="0 0 744 1152" width="744px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="1068.5586" style="stroke:#181818;stroke-width:1.0;" width="10" x="218.5" y="67.7988"/><rect fill="#FFFFFF" height="194.1738" style="stroke:#181818;stroke-width:1.0;" width="10" x="498.5" y="183.041"/><rect fill="#FFFFFF" height="261.4844" style="stroke:#181818;stroke-width:1.0;" width="10" x="498.5" y="484.1465"/><rect fill="#FFFFFF" height="215.6738" style="stroke:#181818;stroke-width:1.0;" width="10" x="498.5" y="847.0625"/><rect fill="none" height="713.1426" style="stroke:#000000;stroke-width:1.5;" width="728" x="10" y="82.7988"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="42" x2="42" y1="36.4883" y2="1145.3574"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="223" x2="223" y1="36.4883" y2="1145.3574"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="503" x2="503" y1="36.4883" y2="1145.3574"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="691" x2="691" y1="36.4883" y2="1145.3574"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="45" x="20" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="27" y="25.5352">User</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="35" x="206" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="213" y="25.5352">CLI</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="71" x="468" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="475" y="25.5352">Gateway</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73" x="655" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="662" y="25.5352">Keystore</text><rect fill="#FFFFFF" height="1068.5586" style="stroke:#181818;stroke-width:1.0;" width="10" x="218.5" y="67.7988"/><rect fill="#FFFFFF" height="194.1738" style="stroke:#181818;stroke-width:1.0;" width="10" x="498.5" y="183.041"/><rect fill="#FFFFFF" height="261.4844" style="stroke:#181818;stroke-width:1.0;" width="10" x="498.5" y="484.1465"/><rect fill="#FFFFFF" height="215.6738" style="stroke:#181818;stroke-width:1.0;" width="10" x="498.5" y="847.0625"/><polygon fill="#181818" points="206.5,63.7988,216.5,67.7988,206.5,71.7988,210.5,67.7988" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="42.5" x2="212.5" y1="67.7988" y2="67.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="49.5" y="63.0566">open account/timesheet</text><path d="M10,82.7988 L72,82.7988 L72,90.1094 L62,100.1094 L10,100.1094 L10,82.7988 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="713.1426" style="stroke:#000000;stroke-width:1.5;" width="728" x="10" y="82.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="25" y="96.3672">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="19" x="87" y="95.4336">[No</text><text fill="#000000" font-family="monospace" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="56" x="110" y="95.1597">auth.key</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="61" x="170" y="95.4336">or expired]</text><polygon fill="#181818" points="53.5,117.4199,43.5,121.4199,53.5,125.4199,49.5,121.4199" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="47.5" x2="217.5" y1="121.4199" y2="121.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="59.5" y="116.6777">"pls enter email"</text><polygon fill="#181818" points="206.5,146.7305,216.5,150.7305,206.5,154.7305,210.5,150.7305" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="42.5" x2="212.5" y1="150.7305" y2="150.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="49.5" y="145.9883">email</text><polygon fill="#181818" points="486.5,179.041,496.5,183.041,486.5,187.041,490.5,183.041" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="228.5" x2="492.5" y1="183.041" y2="183.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="235.5" y="175.2988">jwe(account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="310.5" y="178.9316">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="316.5" y="175.2988">, email)</text><line style="stroke:#181818;stroke-width:1.0;" x1="508.5" x2="550.5" y1="233.6621" y2="233.6621"/><line style="stroke:#181818;stroke-width:1.0;" x1="550.5" x2="550.5" y1="233.6621" y2="246.6621"/><line style="stroke:#181818;stroke-width:1.0;" x1="509.5" x2="550.5" y1="246.6621" y2="246.6621"/><polygon fill="#181818" points="519.5,242.6621,509.5,246.6621,519.5,250.6621,515.5,246.6621" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="515.5" y="207.6094">If account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="578.5" y="211.2422">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="588.5" y="207.6094">exists, check</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="515.5" y="225.9199">account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="565.5" y="229.5527">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="575.5" y="225.9199">and email match</text><polygon fill="#181818" points="239.5,294.7832,229.5,298.7832,239.5,302.7832,235.5,298.7832" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="233.5" x2="497.5" y1="298.7832" y2="298.7832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="19" x="245.5" y="291.041">jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="264.5" y="294.6738">a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="274.5" y="291.041">encrypted with code</text><path d="M21,259.6621 L21,320.6621 L213,320.6621 L213,269.6621 L203,259.6621 L21,259.6621 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M203,259.6621 L203,269.6621 L213,269.6621 L203,259.6621 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="19" x="27" y="277.2305">jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="46" y="280.8633">a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="56" y="277.2305">(activation jwt)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="27" y="295.541">has ⦉ account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="112" y="299.1738">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="118" y="295.541">, email ⦊</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="27" y="313.8516">signed with Gateway secret</text><polygon fill="#181818" points="53.5,343.9043,43.5,347.9043,53.5,351.9043,49.5,347.9043" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="47.5" x2="217.5" y1="347.9043" y2="347.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="59.5" y="343.1621">"pls enter emailed code"</text><polygon fill="#181818" points="53.5,373.2148,43.5,377.2148,53.5,381.2148,49.5,377.2148" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="47.5" x2="502.5" y1="377.2148" y2="377.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="59.5" y="372.4727">activation code by email</text><polygon fill="#181818" points="206.5,402.5254,216.5,406.5254,206.5,410.5254,210.5,406.5254" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="42.5" x2="212.5" y1="406.5254" y2="406.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="49.5" y="401.7832">code</text><line style="stroke:#181818;stroke-width:1.0;" x1="228.5" x2="270.5" y1="438.8359" y2="438.8359"/><line style="stroke:#181818;stroke-width:1.0;" x1="270.5" x2="270.5" y1="438.8359" y2="451.8359"/><line style="stroke:#181818;stroke-width:1.0;" x1="229.5" x2="270.5" y1="451.8359" y2="451.8359"/><polygon fill="#181818" points="239.5,447.8359,229.5,451.8359,239.5,455.8359,235.5,451.8359" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="235.5" y="431.0938">decrypt jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="305.5" y="434.7266">a</text><polygon fill="#181818" points="486.5,480.1465,496.5,484.1465,486.5,488.1465,490.5,484.1465" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="228.5" x2="492.5" y1="484.1465" y2="484.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45" x="235.5" y="476.4043">key(jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="280.5" y="480.0371">a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="286.5" y="476.4043">)</text><line style="stroke:#181818;stroke-width:1.0;" x1="508.5" x2="550.5" y1="516.457" y2="516.457"/><line style="stroke:#181818;stroke-width:1.0;" x1="550.5" x2="550.5" y1="516.457" y2="529.457"/><line style="stroke:#181818;stroke-width:1.0;" x1="509.5" x2="550.5" y1="529.457" y2="529.457"/><polygon fill="#181818" points="519.5,525.457,509.5,529.457,519.5,533.457,515.5,529.457" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="515.5" y="508.7148">verify jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="573.5" y="512.3477">a</text><line style="stroke:#181818;stroke-width:1.0;" x1="508.5" x2="550.5" y1="558.7676" y2="558.7676"/><line style="stroke:#181818;stroke-width:1.0;" x1="550.5" x2="550.5" y1="558.7676" y2="571.7676"/><line style="stroke:#181818;stroke-width:1.0;" x1="509.5" x2="550.5" y1="571.7676" y2="571.7676"/><polygon fill="#181818" points="519.5,567.7676,509.5,571.7676,519.5,575.7676,515.5,571.7676" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="515.5" y="554.0254">create Account if required</text><polygon fill="#181818" points="679.5,597.0781,689.5,601.0781,679.5,605.0781,683.5,601.0781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="508.5" x2="685.5" y1="601.0781" y2="601.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="515.5" y="596.3359">mint AuthKey</text><line style="stroke:#181818;stroke-width:1.0;" x1="508.5" x2="550.5" y1="661.0098" y2="661.0098"/><line style="stroke:#181818;stroke-width:1.0;" x1="550.5" x2="550.5" y1="661.0098" y2="674.0098"/><line style="stroke:#181818;stroke-width:1.0;" x1="509.5" x2="550.5" y1="674.0098" y2="674.0098"/><polygon fill="#181818" points="519.5,670.0098,509.5,674.0098,519.5,678.0098,515.5,674.0098" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="515.5" y="625.6465">generate RSA key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="515.5" y="640.957">pair for signing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56" x="515.5" y="656.2676">⦉ SK, PK ⦊</text><line style="stroke:#181818;stroke-width:1.0;" x1="508.5" x2="550.5" y1="703.3203" y2="703.3203"/><line style="stroke:#181818;stroke-width:1.0;" x1="550.5" x2="550.5" y1="703.3203" y2="716.3203"/><line style="stroke:#181818;stroke-width:1.0;" x1="509.5" x2="550.5" y1="716.3203" y2="716.3203"/><polygon fill="#181818" points="519.5,712.3203,509.5,716.3203,519.5,720.3203,515.5,716.3203" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="515.5" y="698.5781">create &amp; store UserKey</text><polygon fill="#181818" points="239.5,741.6309,229.5,745.6309,239.5,749.6309,235.5,745.6309" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="233.5" x2="502.5" y1="745.6309" y2="745.6309"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="245.5" y="740.8887">UserKey, AuthKey</text><line style="stroke:#181818;stroke-width:1.0;" x1="228.5" x2="270.5" y1="774.9414" y2="774.9414"/><line style="stroke:#181818;stroke-width:1.0;" x1="270.5" x2="270.5" y1="774.9414" y2="787.9414"/><line style="stroke:#181818;stroke-width:1.0;" x1="229.5" x2="270.5" y1="787.9414" y2="787.9414"/><polygon fill="#181818" points="239.5,783.9414,229.5,787.9414,239.5,791.9414,235.5,787.9414" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="32" x="235.5" y="770.1992">store</text><polygon fill="#181818" points="486.5,843.0625,496.5,847.0625,486.5,851.0625,490.5,847.0625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="228.5" x2="492.5" y1="847.0625" y2="847.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="235.5" y="839.3203">config(account/timesheet, jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="425.5" y="842.9531">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="431.5" y="839.3203">)</text><path d="M61,807.9414 L61,868.9414 L213,868.9414 L213,817.9414 L203,807.9414 L61,807.9414 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M203,807.9414 L203,817.9414 L213,817.9414 L203,807.9414 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="19" x="67" y="825.5098">jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="86" y="829.1426">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="96" y="825.5098">(user jwt)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="67" y="843.8203">is ⦉ account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="141" y="847.4531">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="147" y="843.8203">, keyid ⦊</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="67" y="862.1309">signed with SK</text><line style="stroke:#181818;stroke-width:1.0;" x1="508.5" x2="550.5" y1="899.1836" y2="899.1836"/><line style="stroke:#181818;stroke-width:1.0;" x1="550.5" x2="550.5" y1="899.1836" y2="912.1836"/><line style="stroke:#181818;stroke-width:1.0;" x1="509.5" x2="550.5" y1="912.1836" y2="912.1836"/><polygon fill="#181818" points="519.5,908.1836,509.5,912.1836,519.5,916.1836,515.5,912.1836" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="515.5" y="891.4414">verify jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="573.5" y="895.0742">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="583.5" y="891.4414">using PK</text><line style="stroke:#181818;stroke-width:1.0;" x1="508.5" x2="550.5" y1="959.8047" y2="959.8047"/><line style="stroke:#181818;stroke-width:1.0;" x1="550.5" x2="550.5" y1="959.8047" y2="972.8047"/><line style="stroke:#181818;stroke-width:1.0;" x1="509.5" x2="550.5" y1="972.8047" y2="972.8047"/><polygon fill="#181818" points="519.5,968.8047,509.5,972.8047,519.5,976.8047,515.5,972.8047" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="515.5" y="936.752">check keyid belongs to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="515.5" y="952.0625">account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="565.5" y="955.6953">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="575.5" y="952.0625">&amp; not revoked</text><line style="stroke:#181818;stroke-width:1.0;" x1="508.5" x2="550.5" y1="1020.4258" y2="1020.4258"/><line style="stroke:#181818;stroke-width:1.0;" x1="550.5" x2="550.5" y1="1020.4258" y2="1033.4258"/><line style="stroke:#181818;stroke-width:1.0;" x1="509.5" x2="550.5" y1="1033.4258" y2="1033.4258"/><polygon fill="#181818" points="519.5,1029.4258,509.5,1033.4258,519.5,1037.4258,515.5,1033.4258" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="515.5" y="997.373">check account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="606.5" y="1001.0059">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="616.5" y="997.373">has</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="515.5" y="1015.6836">access to timesheet</text><polygon fill="#181818" points="239.5,1058.7363,229.5,1062.7363,239.5,1066.7363,235.5,1062.7363" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="233.5" x2="502.5" y1="1062.7363" y2="1062.7363"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="245.5" y="1057.9941">config</text><polygon fill="#181818" points="491.5,1088.0469,501.5,1092.0469,491.5,1096.0469,495.5,1092.0469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="228.5" x2="497.5" y1="1092.0469" y2="1092.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251" x="235.5" y="1087.3047">connect to timesheet channels via m-ld</text><path d="M25,1105.0469 L25,1130.0469 L241,1130.0469 L241,1115.0469 L231,1105.0469 L25,1105.0469 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M231,1105.0469 L231,1115.0469 L241,1115.0469 L231,1105.0469 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="62.5" y="1122.6152">Proceed with session</text><!--MD5=[1e5b50804b9172847d7d7a7bd87b8905]
@startuml
'https://plantuml.com/sequence-diagram
hide footbox

User -> CLI ++: open account/timesheet
alt No ""auth.key"" or expired
  CLI -> User: "pls enter email"
  User - -> CLI: email
  CLI -> Gateway ++: jwe(account<sub>u</sub>, email)
  Gateway -> Gateway: If account<sub>u</sub> exists, check\naccount<sub>u</sub> and email match
  Gateway - -> CLI: jwt<sub>a</sub> encrypted with code
  note left
    jwt<sub>a</sub> (activation jwt)
    has ⦉ account<sub>u</sub>, email ⦊
    signed with Gateway secret
  end note
  CLI -> User: "pls enter emailed code"
  Gateway - -> User - -: activation code by email

  User - -> CLI: code
  ' TODO: brute force attack (look for a parseable JWT)
  CLI -> CLI: decrypt jwt<sub>a</sub>
  ' TODO: replay attack within JWT validity period
  CLI -> Gateway ++: key(jwt<sub>a</sub>)

  Gateway -> Gateway: verify jwt<sub>a</sub>
  Gateway -> Gateway: create Account if required
  Gateway -> Keystore: mint AuthKey
  Gateway -> Gateway: generate RSA key\npair for signing\n⦉ SK, PK ⦊
  Gateway -> Gateway: create & store UserKey
  return UserKey, AuthKey

  CLI -> CLI: store
end

CLI -> Gateway ++: config(account/timesheet, jwt<sub>u</sub>)
note left
  jwt<sub>u</sub> (user jwt)
  is ⦉ account<sub>u</sub>, keyid ⦊
  signed with SK
end note
Gateway -> Gateway: verify jwt<sub>u</sub> using PK
Gateway -> Gateway: check keyid belongs to\naccount<sub>u</sub> & not revoked
Gateway -> Gateway: check account<sub>u</sub> has\naccess to timesheet
return config

CLI -> Gateway: connect to timesheet channels via m-ld
note over User, CLI: Proceed with session

@enduml

@startuml
hide footbox

User -> CLI ++: open account/timesheet
alt No ""auth.key"" or expired
  CLI -> User: "pls enter email"
  User - -> CLI: email
  CLI -> Gateway ++: jwe(account<sub>u</sub>, email)
  Gateway -> Gateway: If account<sub>u</sub> exists, check\naccount<sub>u</sub> and email match
  Gateway - -> CLI: jwt<sub>a</sub> encrypted with code
  note left
    jwt<sub>a</sub> (activation jwt)
    has ⦉ account<sub>u</sub>, email ⦊
    signed with Gateway secret
  end note
  CLI -> User: "pls enter emailed code"
  Gateway - -> User - -: activation code by email

  User - -> CLI: code
  CLI -> CLI: decrypt jwt<sub>a</sub>
  CLI -> Gateway ++: key(jwt<sub>a</sub>)

  Gateway -> Gateway: verify jwt<sub>a</sub>
  Gateway -> Gateway: create Account if required
  Gateway -> Keystore: mint AuthKey
  Gateway -> Gateway: generate RSA key\npair for signing\n⦉ SK, PK ⦊
  Gateway -> Gateway: create & store UserKey
  return UserKey, AuthKey

  CLI -> CLI: store
end

CLI -> Gateway ++: config(account/timesheet, jwt<sub>u</sub>)
note left
  jwt<sub>u</sub> (user jwt)
  is ⦉ account<sub>u</sub>, keyid ⦊
  signed with SK
end note
Gateway -> Gateway: verify jwt<sub>u</sub> using PK
Gateway -> Gateway: check keyid belongs to\naccount<sub>u</sub> & not revoked
Gateway -> Gateway: check account<sub>u</sub> has\naccess to timesheet
return config

CLI -> Gateway: connect to timesheet channels via m-ld
note over User, CLI: Proceed with session

@enduml

PlantUML version 1.2022.8(Sun Sep 25 10:00:33 BST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>