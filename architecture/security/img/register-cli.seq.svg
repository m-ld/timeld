<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="963px" preserveAspectRatio="none" style="width:707px;height:963px;background:#FFFFFF;" version="1.1" viewBox="0 0 707 963" width="707px" zoomAndPan="magnify"><defs><filter height="300%" id="fnmnvqtg6krzo" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fnmnvqtg6krzo)" height="875.8281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="220.5" y="71.7988"/><rect fill="#FFFFFF" filter="url(#fnmnvqtg6krzo)" height="198.1738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="500.5" y="187.041"/><rect fill="#FFFFFF" filter="url(#fnmnvqtg6krzo)" height="144.375" style="stroke:#A80036;stroke-width:1.0;" width="10" x="500.5" y="492.1465"/><rect fill="#FFFFFF" filter="url(#fnmnvqtg6krzo)" height="172.3633" style="stroke:#A80036;stroke-width:1.0;" width="10" x="500.5" y="697.6426"/><rect fill="#FFFFFF" filter="url(#fnmnvqtg6krzo)" height="557.7227" style="stroke:#000000;stroke-width:2.0;" width="684.5" x="9" y="86.7988"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="44" x2="44" y1="40.4883" y2="956.627"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="225" x2="225" y1="40.4883" y2="956.627"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="505" x2="505" y1="40.4883" y2="956.627"/><rect fill="#FEFECE" filter="url(#fnmnvqtg6krzo)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="45" x="20" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="27" y="25.5352">User</text><rect fill="#FEFECE" filter="url(#fnmnvqtg6krzo)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="35" x="206" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="213" y="25.5352">CLI</text><rect fill="#FEFECE" filter="url(#fnmnvqtg6krzo)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="71" x="468" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="475" y="25.5352">Gateway</text><rect fill="#FFFFFF" filter="url(#fnmnvqtg6krzo)" height="875.8281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="220.5" y="71.7988"/><rect fill="#FFFFFF" filter="url(#fnmnvqtg6krzo)" height="198.1738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="500.5" y="187.041"/><rect fill="#FFFFFF" filter="url(#fnmnvqtg6krzo)" height="144.375" style="stroke:#A80036;stroke-width:1.0;" width="10" x="500.5" y="492.1465"/><rect fill="#FFFFFF" filter="url(#fnmnvqtg6krzo)" height="172.3633" style="stroke:#A80036;stroke-width:1.0;" width="10" x="500.5" y="697.6426"/><polygon fill="#A80036" points="208.5,67.7988,218.5,71.7988,208.5,75.7988,212.5,71.7988" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="44.5" x2="214.5" y1="71.7988" y2="71.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="51.5" y="67.0566">open account/timesheet</text><path d="M9,86.7988 L71,86.7988 L71,93.7988 L61,103.7988 L9,103.7988 L9,86.7988 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="557.7227" style="stroke:#000000;stroke-width:2.0;" width="684.5" x="9" y="86.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="24" y="100.3672">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="19" x="86" y="99.4336">[No</text><text fill="#000000" font-family="monospace" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="56" x="109" y="99.1597">auth.key</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="61" x="169" y="99.4336">or expired]</text><polygon fill="#A80036" points="55.5,121.4199,45.5,125.4199,55.5,129.4199,51.5,125.4199" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="49.5" x2="219.5" y1="125.4199" y2="125.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="61.5" y="120.6777">"pls enter email"</text><polygon fill="#A80036" points="208.5,150.7305,218.5,154.7305,208.5,158.7305,212.5,154.7305" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="44.5" x2="214.5" y1="154.7305" y2="154.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="51.5" y="149.9883">email</text><polygon fill="#A80036" points="488.5,183.041,498.5,187.041,488.5,191.041,492.5,187.041" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="230.5" x2="494.5" y1="187.041" y2="187.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="237.5" y="179.2988">jwe(account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="312.5" y="182.9316">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="318.5" y="179.2988">, email)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="510.5" x2="552.5" y1="237.6621" y2="237.6621"/><line style="stroke:#A80036;stroke-width:1.0;" x1="552.5" x2="552.5" y1="237.6621" y2="250.6621"/><line style="stroke:#A80036;stroke-width:1.0;" x1="511.5" x2="552.5" y1="250.6621" y2="250.6621"/><polygon fill="#A80036" points="521.5,246.6621,511.5,250.6621,521.5,254.6621,517.5,250.6621" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="517.5" y="211.6094">If account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="580.5" y="215.2422">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="590.5" y="211.6094">exists, check</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="517.5" y="229.9199">account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="567.5" y="233.5527">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="577.5" y="229.9199">and email match</text><polygon fill="#A80036" points="241.5,300.7832,231.5,304.7832,241.5,308.7832,237.5,304.7832" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="235.5" x2="499.5" y1="304.7832" y2="304.7832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="19" x="247.5" y="297.041">jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="266.5" y="300.6738">a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="276.5" y="297.041">encrypted with code</text><path d="M19,263.6621 L19,324.6621 L211,324.6621 L211,273.6621 L201,263.6621 L19,263.6621 " fill="#FBFB77" filter="url(#fnmnvqtg6krzo)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M201,263.6621 L201,273.6621 L211,273.6621 L201,263.6621 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="19" x="25" y="281.2305">jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="44" y="284.8633">a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="54" y="281.2305">(activation jwt)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="25" y="299.541">has ⦉ account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="110" y="303.1738">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="116" y="299.541">, email ⦊</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="25" y="317.8516">signed with Gateway secret</text><polygon fill="#A80036" points="55.5,351.9043,45.5,355.9043,55.5,359.9043,51.5,355.9043" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="49.5" x2="219.5" y1="355.9043" y2="355.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="61.5" y="351.1621">"pls enter emailed code"</text><polygon fill="#A80036" points="55.5,381.2148,45.5,385.2148,55.5,389.2148,51.5,385.2148" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="49.5" x2="504.5" y1="385.2148" y2="385.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="61.5" y="380.4727">activation code by email</text><polygon fill="#A80036" points="208.5,410.5254,218.5,414.5254,208.5,418.5254,212.5,414.5254" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="44.5" x2="214.5" y1="414.5254" y2="414.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="51.5" y="409.7832">code</text><line style="stroke:#A80036;stroke-width:1.0;" x1="230.5" x2="272.5" y1="446.8359" y2="446.8359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="272.5" x2="272.5" y1="446.8359" y2="459.8359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="231.5" x2="272.5" y1="459.8359" y2="459.8359"/><polygon fill="#A80036" points="241.5,455.8359,231.5,459.8359,241.5,463.8359,237.5,459.8359" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="237.5" y="439.0938">decrypt jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="307.5" y="442.7266">a</text><polygon fill="#A80036" points="488.5,488.1465,498.5,492.1465,488.5,496.1465,492.5,492.1465" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="230.5" x2="494.5" y1="492.1465" y2="492.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45" x="237.5" y="484.4043">key(jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="282.5" y="488.0371">a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="288.5" y="484.4043">)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="510.5" x2="552.5" y1="536.7676" y2="536.7676"/><line style="stroke:#A80036;stroke-width:1.0;" x1="552.5" x2="552.5" y1="536.7676" y2="549.7676"/><line style="stroke:#A80036;stroke-width:1.0;" x1="511.5" x2="552.5" y1="549.7676" y2="549.7676"/><polygon fill="#A80036" points="521.5,545.7676,511.5,549.7676,521.5,553.7676,517.5,549.7676" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="517.5" y="516.7148">create Account</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="517.5" y="532.0254">if required</text><line style="stroke:#A80036;stroke-width:1.0;" x1="510.5" x2="552.5" y1="594.3887" y2="594.3887"/><line style="stroke:#A80036;stroke-width:1.0;" x1="552.5" x2="552.5" y1="594.3887" y2="607.3887"/><line style="stroke:#A80036;stroke-width:1.0;" x1="511.5" x2="552.5" y1="607.3887" y2="607.3887"/><polygon fill="#A80036" points="521.5,603.3887,511.5,607.3887,521.5,611.3887,517.5,607.3887" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="517.5" y="574.3359">create/update key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="517.5" y="589.6465">in Account</text><polygon fill="#A80036" points="241.5,632.5215,231.5,636.5215,241.5,640.5215,237.5,636.5215" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="235.5" x2="504.5" y1="636.5215" y2="636.5215"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="247.5" y="631.4556">auth.key</text><polygon fill="#A80036" points="488.5,693.6426,498.5,697.6426,488.5,701.6426,492.5,697.6426" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="230.5" x2="494.5" y1="697.6426" y2="697.6426"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="237.5" y="689.9004">config(account/timesheet, jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="427.5" y="693.5332">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="433.5" y="689.9004">)</text><path d="M49,656.5215 L49,717.5215 L211,717.5215 L211,666.5215 L201,656.5215 L49,656.5215 " fill="#FBFB77" filter="url(#fnmnvqtg6krzo)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M201,656.5215 L201,666.5215 L211,666.5215 L201,656.5215 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="19" x="55" y="674.0898">jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="74" y="677.7227">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="84" y="674.0898">(user jwt)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="55" y="692.4004">is ⦉ account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="129" y="696.0332">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="135" y="692.4004">, keyid ⦊</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73" x="55" y="710.7109">signed with</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="132" y="710.3872">auth.key</text><line style="stroke:#A80036;stroke-width:1.0;" x1="510.5" x2="552.5" y1="767.0742" y2="767.0742"/><line style="stroke:#A80036;stroke-width:1.0;" x1="552.5" x2="552.5" y1="767.0742" y2="780.0742"/><line style="stroke:#A80036;stroke-width:1.0;" x1="511.5" x2="552.5" y1="780.0742" y2="780.0742"/><polygon fill="#A80036" points="521.5,776.0742,511.5,780.0742,521.5,784.0742,517.5,780.0742" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="517.5" y="744.0215">check account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="608.5" y="747.6543">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="517.5" y="762.332">corresponds to keyid</text><line style="stroke:#A80036;stroke-width:1.0;" x1="510.5" x2="552.5" y1="827.6953" y2="827.6953"/><line style="stroke:#A80036;stroke-width:1.0;" x1="552.5" x2="552.5" y1="827.6953" y2="840.6953"/><line style="stroke:#A80036;stroke-width:1.0;" x1="511.5" x2="552.5" y1="840.6953" y2="840.6953"/><polygon fill="#A80036" points="521.5,836.6953,511.5,840.6953,521.5,844.6953,517.5,840.6953" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="517.5" y="804.6426">check account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="608.5" y="808.2754">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="618.5" y="804.6426">has</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="517.5" y="822.9531">access to timesheet</text><polygon fill="#A80036" points="241.5,866.0059,231.5,870.0059,241.5,874.0059,237.5,870.0059" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="235.5" x2="504.5" y1="870.0059" y2="870.0059"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="247.5" y="865.2637">config</text><polygon fill="#A80036" points="493.5,895.3164,503.5,899.3164,493.5,903.3164,497.5,899.3164" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="230.5" x2="499.5" y1="899.3164" y2="899.3164"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251" x="237.5" y="894.5742">connect to timesheet channels via m-ld</text><path d="M25,912.3164 L25,937.3164 L245,937.3164 L245,922.3164 L235,912.3164 L25,912.3164 " fill="#FBFB77" filter="url(#fnmnvqtg6krzo)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M235,912.3164 L235,922.3164 L245,922.3164 L235,912.3164 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="62.5" y="929.8848">Proceed with session</text><!--MD5=[de04451b4cf231c2f000fa156671cd97]
@startuml
'https://plantuml.com/sequence-diagram
hide footbox

User -> CLI ++: open account/timesheet
alt No ""auth.key"" or expired
  CLI -> User: "pls enter email"
  User - -> CLI: email
  CLI -> Gateway ++: jwe(account<sub>u</sub>, email)
  Gateway -> Gateway: If account<sub>u</sub> exists, check\naccount<sub>u</sub> and email match
  Gateway - -> CLI: jwt<sub>a</sub> encrypted with code
  note left
    jwt<sub>a</sub> (activation jwt)
    has ⦉ account<sub>u</sub>, email ⦊
    signed with Gateway secret
  end note
  CLI -> User: "pls enter emailed code"
  Gateway - -> User - -: activation code by email

  User - -> CLI: code
  ' TODO: brute force attack (look for a parseable JWT)
  CLI -> CLI: decrypt jwt<sub>a</sub>
  ' TODO: replay attack within JWT validity period
  CLI -> Gateway ++: key(jwt<sub>a</sub>)
  Gateway -> Gateway: create Account\nif required
  Gateway -> Gateway: create/update key\nin Account
  return ""auth.key""
end

CLI -> Gateway ++: config(account/timesheet, jwt<sub>u</sub>)
note left
  jwt<sub>u</sub> (user jwt)
  is ⦉ account<sub>u</sub>, keyid ⦊
  signed with ""auth.key""
end note
Gateway -> Gateway: check account<sub>u</sub>\ncorresponds to keyid
Gateway -> Gateway: check account<sub>u</sub> has\naccess to timesheet
return config

CLI -> Gateway: connect to timesheet channels via m-ld
note over User, CLI: Proceed with session

@enduml

@startuml
hide footbox

User -> CLI ++: open account/timesheet
alt No ""auth.key"" or expired
  CLI -> User: "pls enter email"
  User - -> CLI: email
  CLI -> Gateway ++: jwe(account<sub>u</sub>, email)
  Gateway -> Gateway: If account<sub>u</sub> exists, check\naccount<sub>u</sub> and email match
  Gateway - -> CLI: jwt<sub>a</sub> encrypted with code
  note left
    jwt<sub>a</sub> (activation jwt)
    has ⦉ account<sub>u</sub>, email ⦊
    signed with Gateway secret
  end note
  CLI -> User: "pls enter emailed code"
  Gateway - -> User - -: activation code by email

  User - -> CLI: code
  CLI -> CLI: decrypt jwt<sub>a</sub>
  CLI -> Gateway ++: key(jwt<sub>a</sub>)
  Gateway -> Gateway: create Account\nif required
  Gateway -> Gateway: create/update key\nin Account
  return ""auth.key""
end

CLI -> Gateway ++: config(account/timesheet, jwt<sub>u</sub>)
note left
  jwt<sub>u</sub> (user jwt)
  is ⦉ account<sub>u</sub>, keyid ⦊
  signed with ""auth.key""
end note
Gateway -> Gateway: check account<sub>u</sub>\ncorresponds to keyid
Gateway -> Gateway: check account<sub>u</sub> has\naccess to timesheet
return config

CLI -> Gateway: connect to timesheet channels via m-ld
note over User, CLI: Proceed with session

@enduml

PlantUML version 1.2021.10(Mon Aug 30 14:43:48 BST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>