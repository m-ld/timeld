<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1219px" preserveAspectRatio="none" style="width:700px;height:1219px;background:#FFFFFF;" version="1.1" viewBox="0 0 700 1219" width="700px" zoomAndPan="magnify"><defs><filter height="300%" id="f1wkm4ty3aojns" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1wkm4ty3aojns)" height="1131.623" style="stroke:#A80036;stroke-width:1.0;" width="10" x="230.5" y="71.7988"/><rect fill="#FFFFFF" filter="url(#f1wkm4ty3aojns)" height="198.1738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="459.5" y="355.9043"/><rect fill="#FFFFFF" filter="url(#f1wkm4ty3aojns)" height="188.9961" style="stroke:#A80036;stroke-width:1.0;" width="10" x="459.5" y="661.0098"/><rect fill="#FFFFFF" filter="url(#f1wkm4ty3aojns)" height="214.6738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="459.5" y="911.127"/><rect fill="#FFFFFF" filter="url(#f1wkm4ty3aojns)" height="771.207" style="stroke:#000000;stroke-width:2.0;" width="676.5" x="10" y="86.7988"/><rect fill="#FFFFFF" filter="url(#f1wkm4ty3aojns)" height="154.8633" style="stroke:#000000;stroke-width:2.0;" width="360" x="20" y="111.1094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="54" x2="54" y1="40.4883" y2="1212.4219"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="235" x2="235" y1="40.4883" y2="1212.4219"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="464" x2="464" y1="40.4883" y2="1212.4219"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="652.5" x2="652.5" y1="40.4883" y2="1212.4219"/><rect fill="#FEFECE" filter="url(#f1wkm4ty3aojns)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="45" x="30" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="37" y="25.5352">User</text><rect fill="#FEFECE" filter="url(#f1wkm4ty3aojns)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="35" x="216" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="223" y="25.5352">CLI</text><rect fill="#FEFECE" filter="url(#f1wkm4ty3aojns)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="71" x="427" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="434" y="25.5352">Gateway</text><rect fill="#FEFECE" filter="url(#f1wkm4ty3aojns)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="44" x="628.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="635.5" y="25.5352">Ably</text><rect fill="#FFFFFF" filter="url(#f1wkm4ty3aojns)" height="1131.623" style="stroke:#A80036;stroke-width:1.0;" width="10" x="230.5" y="71.7988"/><rect fill="#FFFFFF" filter="url(#f1wkm4ty3aojns)" height="198.1738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="459.5" y="355.9043"/><rect fill="#FFFFFF" filter="url(#f1wkm4ty3aojns)" height="188.9961" style="stroke:#A80036;stroke-width:1.0;" width="10" x="459.5" y="661.0098"/><rect fill="#FFFFFF" filter="url(#f1wkm4ty3aojns)" height="214.6738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="459.5" y="911.127"/><polygon fill="#A80036" points="218.5,67.7988,228.5,71.7988,218.5,75.7988,222.5,71.7988" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="54.5" x2="224.5" y1="71.7988" y2="71.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="61.5" y="67.0566">open account/timesheet</text><path d="M10,86.7988 L72,86.7988 L72,93.7988 L62,103.7988 L10,103.7988 L10,86.7988 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="771.207" style="stroke:#000000;stroke-width:2.0;" width="676.5" x="10" y="86.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="25" y="100.3672">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="19" x="87" y="99.4336">[No</text><text fill="#000000" font-family="monospace" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="56" x="110" y="99.1597">ably.key</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="61" x="170" y="99.4336">or expired]</text><path d="M20,111.1094 L82,111.1094 L82,118.1094 L72,128.1094 L20,128.1094 L20,111.1094 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="154.8633" style="stroke:#000000;stroke-width:2.0;" width="360" x="20" y="111.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="35" y="124.6777">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="116" x="97" y="123.7441">[No user configured]</text><path d="M100,133.4199 L100,194.4199 L366,194.4199 L366,143.4199 L356,133.4199 L100,133.4199 " fill="#FBFB77" filter="url(#f1wkm4ty3aojns)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M356,133.4199 L356,143.4199 L366,143.4199 L356,133.4199 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="106" y="150.9883">configured user is account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="274" y="154.6211">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="280" y="150.9883">.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="106" y="169.2988">Not always the same as requested</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="106" y="184.6094">timesheet account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="4" x="222" y="188.2422">t</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="226" y="184.6094">, but use as default.</text><polygon fill="#A80036" points="65.5,221.6621,55.5,225.6621,65.5,229.6621,61.5,225.6621" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="59.5" x2="229.5" y1="225.6621" y2="225.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="71.5" y="220.9199">"your account?"</text><polygon fill="#A80036" points="218.5,253.9727,228.5,257.9727,218.5,261.9727,222.5,257.9727" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="54.5" x2="224.5" y1="257.9727" y2="257.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="61.5" y="250.2305">account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="111.5" y="253.8633">u</text><polygon fill="#A80036" points="65.5,290.2832,55.5,294.2832,65.5,298.2832,61.5,294.2832" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="59.5" x2="229.5" y1="294.2832" y2="294.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="71.5" y="289.541">"pls enter email"</text><polygon fill="#A80036" points="218.5,319.5938,228.5,323.5938,218.5,327.5938,222.5,323.5938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="54.5" x2="224.5" y1="323.5938" y2="323.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="61.5" y="318.8516">email</text><polygon fill="#A80036" points="447.5,351.9043,457.5,355.9043,447.5,359.9043,451.5,355.9043" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="240.5" x2="453.5" y1="355.9043" y2="355.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="247.5" y="348.1621">jwe(account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="322.5" y="351.7949">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="328.5" y="348.1621">, email)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="469.5" x2="511.5" y1="406.5254" y2="406.5254"/><line style="stroke:#A80036;stroke-width:1.0;" x1="511.5" x2="511.5" y1="406.5254" y2="419.5254"/><line style="stroke:#A80036;stroke-width:1.0;" x1="470.5" x2="511.5" y1="419.5254" y2="419.5254"/><polygon fill="#A80036" points="480.5,415.5254,470.5,419.5254,480.5,423.5254,476.5,419.5254" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="476.5" y="380.4727">If account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="539.5" y="384.1055">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="549.5" y="380.4727">exists, check</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="476.5" y="398.7832">account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="526.5" y="402.416">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="536.5" y="398.7832">and email match</text><polygon fill="#A80036" points="251.5,469.6465,241.5,473.6465,251.5,477.6465,247.5,473.6465" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="245.5" x2="458.5" y1="473.6465" y2="473.6465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="19" x="257.5" y="465.9043">jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="276.5" y="469.5371">a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="286.5" y="465.9043">encrypted with code</text><path d="M29,432.5254 L29,493.5254 L221,493.5254 L221,442.5254 L211,432.5254 L29,432.5254 " fill="#FBFB77" filter="url(#f1wkm4ty3aojns)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M211,432.5254 L211,442.5254 L221,442.5254 L211,432.5254 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="19" x="35" y="450.0938">jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="54" y="453.7266">a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="64" y="450.0938">(activation jwt)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="35" y="468.4043">has ⦉ account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="120" y="472.0371">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="126" y="468.4043">, email ⦊</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="35" y="486.7148">signed with Gateway secret</text><polygon fill="#A80036" points="65.5,520.7676,55.5,524.7676,65.5,528.7676,61.5,524.7676" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="59.5" x2="229.5" y1="524.7676" y2="524.7676"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="71.5" y="520.0254">"pls enter emailed code"</text><polygon fill="#A80036" points="65.5,550.0781,55.5,554.0781,65.5,558.0781,61.5,554.0781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="59.5" x2="463.5" y1="554.0781" y2="554.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="71.5" y="549.3359">activation code by email</text><polygon fill="#A80036" points="218.5,579.3887,228.5,583.3887,218.5,587.3887,222.5,583.3887" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="54.5" x2="224.5" y1="583.3887" y2="583.3887"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="61.5" y="578.6465">code</text><line style="stroke:#A80036;stroke-width:1.0;" x1="240.5" x2="282.5" y1="615.6992" y2="615.6992"/><line style="stroke:#A80036;stroke-width:1.0;" x1="282.5" x2="282.5" y1="615.6992" y2="628.6992"/><line style="stroke:#A80036;stroke-width:1.0;" x1="241.5" x2="282.5" y1="628.6992" y2="628.6992"/><polygon fill="#A80036" points="251.5,624.6992,241.5,628.6992,251.5,632.6992,247.5,628.6992" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="247.5" y="607.957">decrypt jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="317.5" y="611.5898">a</text><polygon fill="#A80036" points="447.5,657.0098,457.5,661.0098,447.5,665.0098,451.5,661.0098" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="240.5" x2="453.5" y1="661.0098" y2="661.0098"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45" x="247.5" y="653.2676">key(jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="292.5" y="656.9004">a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="298.5" y="653.2676">)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="469.5" x2="511.5" y1="705.6309" y2="705.6309"/><line style="stroke:#A80036;stroke-width:1.0;" x1="511.5" x2="511.5" y1="705.6309" y2="718.6309"/><line style="stroke:#A80036;stroke-width:1.0;" x1="470.5" x2="511.5" y1="718.6309" y2="718.6309"/><polygon fill="#A80036" points="480.5,714.6309,470.5,718.6309,480.5,722.6309,476.5,718.6309" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="476.5" y="685.5781">create Account</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="476.5" y="700.8887">if required</text><polygon fill="#A80036" points="480.5,759.252,470.5,763.252,480.5,767.252,476.5,763.252" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="640.5,759.252,650.5,763.252,640.5,767.252,644.5,763.252" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="474.5" x2="646.5" y1="763.252" y2="763.252"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="486.5" y="743.1992">create/update key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="486.5" y="758.5098">&amp; capabilities</text><line style="stroke:#A80036;stroke-width:1.0;" x1="469.5" x2="511.5" y1="807.873" y2="807.873"/><line style="stroke:#A80036;stroke-width:1.0;" x1="511.5" x2="511.5" y1="807.873" y2="820.873"/><line style="stroke:#A80036;stroke-width:1.0;" x1="470.5" x2="511.5" y1="820.873" y2="820.873"/><polygon fill="#A80036" points="480.5,816.873,470.5,820.873,480.5,824.873,476.5,820.873" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="476.5" y="787.8203">store keyid</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="476.5" y="803.1309">in Account</text><polygon fill="#A80036" points="251.5,846.0059,241.5,850.0059,251.5,854.0059,247.5,850.0059" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="245.5" x2="463.5" y1="850.0059" y2="850.0059"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="257.5" y="844.9399">ably.key</text><polygon fill="#A80036" points="447.5,907.127,457.5,911.127,447.5,915.127,451.5,911.127" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="240.5" x2="453.5" y1="911.127" y2="911.127"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="247.5" y="903.3848">config(account/timesheet, jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="437.5" y="907.0176">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="443.5" y="903.3848">)</text><path d="M59,870.0059 L59,931.0059 L221,931.0059 L221,880.0059 L211,870.0059 L59,870.0059 " fill="#FBFB77" filter="url(#f1wkm4ty3aojns)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M211,870.0059 L211,880.0059 L221,880.0059 L211,870.0059 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="19" x="65" y="887.5742">jwt</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="84" y="891.207">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="94" y="887.5742">(user jwt)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="65" y="905.8848">is ⦉ account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="139" y="909.5176">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="145" y="905.8848">, keyid ⦊</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73" x="65" y="924.1953">signed with</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="64" x="142" y="923.8716">ably.key</text><line style="stroke:#A80036;stroke-width:1.0;" x1="469.5" x2="511.5" y1="980.5586" y2="980.5586"/><line style="stroke:#A80036;stroke-width:1.0;" x1="511.5" x2="511.5" y1="980.5586" y2="993.5586"/><line style="stroke:#A80036;stroke-width:1.0;" x1="470.5" x2="511.5" y1="993.5586" y2="993.5586"/><polygon fill="#A80036" points="480.5,989.5586,470.5,993.5586,480.5,997.5586,476.5,993.5586" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="476.5" y="957.5059">check account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="567.5" y="961.1387">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="476.5" y="975.8164">corresponds to keyid</text><line style="stroke:#A80036;stroke-width:1.0;" x1="469.5" x2="511.5" y1="1041.1797" y2="1041.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="511.5" x2="511.5" y1="1041.1797" y2="1054.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="470.5" x2="511.5" y1="1054.1797" y2="1054.1797"/><polygon fill="#A80036" points="480.5,1050.1797,470.5,1054.1797,480.5,1058.1797,476.5,1054.1797" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="476.5" y="1018.127">check account</text><text fill="#000000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="6" x="567.5" y="1021.7598">u</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="577.5" y="1018.127">has</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="476.5" y="1036.4375">access to timesheet</text><line style="stroke:#A80036;stroke-width:1.0;" x1="469.5" x2="511.5" y1="1083.4902" y2="1083.4902"/><line style="stroke:#A80036;stroke-width:1.0;" x1="511.5" x2="511.5" y1="1083.4902" y2="1096.4902"/><line style="stroke:#A80036;stroke-width:1.0;" x1="470.5" x2="511.5" y1="1096.4902" y2="1096.4902"/><polygon fill="#A80036" points="480.5,1092.4902,470.5,1096.4902,480.5,1100.4902,476.5,1096.4902" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="476.5" y="1078.748">update key capability</text><polygon fill="#A80036" points="251.5,1121.8008,241.5,1125.8008,251.5,1129.8008,247.5,1125.8008" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="245.5" x2="463.5" y1="1125.8008" y2="1125.8008"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="257.5" y="1121.0586">config</text><polygon fill="#A80036" points="640.5,1151.1113,650.5,1155.1113,640.5,1159.1113,644.5,1155.1113" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="240.5" x2="646.5" y1="1155.1113" y2="1155.1113"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251" x="247.5" y="1150.3691">connect to timesheet channels via m-ld</text><path d="M35,1168.1113 L35,1193.1113 L255,1193.1113 L255,1178.1113 L245,1168.1113 L35,1168.1113 " fill="#FBFB77" filter="url(#f1wkm4ty3aojns)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M245,1168.1113 L245,1178.1113 L255,1178.1113 L245,1168.1113 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="72.5" y="1185.6797">Proceed with session</text><!--MD5=[87857e7f182d43681d9a3bcb7e57ad62]
@startuml
'https://plantuml.com/sequence-diagram
hide footbox

User -> CLI ++: open account/timesheet
alt No ""ably.key"" or expired
  alt No user configured
    note over CLI
      configured user is account<sub>u</sub>.
      Not always the same as requested
      timesheet account<sub>t</sub>, but use as default.
    end note
    CLI -> User: "your account?"
    User - -> CLI: account<sub>u</sub>
  end
  CLI -> User: "pls enter email"
  User - -> CLI: email
  CLI -> Gateway ++: jwe(account<sub>u</sub>, email)
  Gateway -> Gateway: If account<sub>u</sub> exists, check\naccount<sub>u</sub> and email match
  Gateway - -> CLI: jwt<sub>a</sub> encrypted with code
  note left
    jwt<sub>a</sub> (activation jwt)
    has ⦉ account<sub>u</sub>, email ⦊
    signed with Gateway secret
  end note
  CLI -> User: "pls enter emailed code"
  Gateway - -> User - -: activation code by email

  User - -> CLI: code
  ' TODO: brute force attack (look for a parseable JWT)
  CLI -> CLI: decrypt jwt<sub>a</sub>
  ' TODO: replay attack within JWT validity period
  CLI -> Gateway ++: key(jwt<sub>a</sub>)
  Gateway -> Gateway: create Account\nif required
  Gateway <-> Ably: create/update key\n& capabilities
  Gateway -> Gateway: store keyid\nin Account
  return ""ably.key""
end

CLI -> Gateway ++: config(account/timesheet, jwt<sub>u</sub>)
note left
  jwt<sub>u</sub> (user jwt)
  is ⦉ account<sub>u</sub>, keyid ⦊
  signed with ""ably.key""
end note
Gateway -> Gateway: check account<sub>u</sub>\ncorresponds to keyid
Gateway -> Gateway: check account<sub>u</sub> has\naccess to timesheet
Gateway -> Gateway: update key capability
return config

CLI -> Ably: connect to timesheet channels via m-ld
note over User, CLI: Proceed with session

@enduml

@startuml
hide footbox

User -> CLI ++: open account/timesheet
alt No ""ably.key"" or expired
  alt No user configured
    note over CLI
      configured user is account<sub>u</sub>.
      Not always the same as requested
      timesheet account<sub>t</sub>, but use as default.
    end note
    CLI -> User: "your account?"
    User - -> CLI: account<sub>u</sub>
  end
  CLI -> User: "pls enter email"
  User - -> CLI: email
  CLI -> Gateway ++: jwe(account<sub>u</sub>, email)
  Gateway -> Gateway: If account<sub>u</sub> exists, check\naccount<sub>u</sub> and email match
  Gateway - -> CLI: jwt<sub>a</sub> encrypted with code
  note left
    jwt<sub>a</sub> (activation jwt)
    has ⦉ account<sub>u</sub>, email ⦊
    signed with Gateway secret
  end note
  CLI -> User: "pls enter emailed code"
  Gateway - -> User - -: activation code by email

  User - -> CLI: code
  CLI -> CLI: decrypt jwt<sub>a</sub>
  CLI -> Gateway ++: key(jwt<sub>a</sub>)
  Gateway -> Gateway: create Account\nif required
  Gateway <-> Ably: create/update key\n& capabilities
  Gateway -> Gateway: store keyid\nin Account
  return ""ably.key""
end

CLI -> Gateway ++: config(account/timesheet, jwt<sub>u</sub>)
note left
  jwt<sub>u</sub> (user jwt)
  is ⦉ account<sub>u</sub>, keyid ⦊
  signed with ""ably.key""
end note
Gateway -> Gateway: check account<sub>u</sub>\ncorresponds to keyid
Gateway -> Gateway: check account<sub>u</sub> has\naccess to timesheet
Gateway -> Gateway: update key capability
return config

CLI -> Ably: connect to timesheet channels via m-ld
note over User, CLI: Proceed with session

@enduml

PlantUML version 1.2021.10(Mon Aug 30 14:43:48 BST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>